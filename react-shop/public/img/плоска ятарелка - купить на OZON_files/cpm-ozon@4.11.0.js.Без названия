!function(){var e,t,s=(function(e,t){var s,n,i,r;Object.defineProperty(t,"__esModule",{value:!0}),function(e){e.IMAGES="images",e.SCRIPTS="scripts",e.CSS="css",e.FONTS="fonts",e.JSON="json"}(s||(s={})),function(e){e.ASYNC_ACTION="asyncAction"}(n||(n={})),t.PerformanceEntryType=void 0,(i=t.PerformanceEntryType||(t.PerformanceEntryType={})).MARK="mark",i.MEASURE="measure",i.NAVIGATION="navigation",i.RESOURCE="resource",i.LONGTASK="longtask",i.PAINT="paint",i.ELEMENT="element",i.EVENT="event",i.FID="first-input",i.CLS="layout-shift",i.LCP="largest-contentful-paint",function(e){e.NAVIGATION="navigation",e.CSS="css",e.SCRIPT="script",e.XHR="xmlhttprequest",e.FETCH="fetch",e.BEACON="beacon",e.VIDEO="video",e.AUDIO="audio",e.TRACK="track",e.IMG="img",e.IMAGE="image",e.INPUT="input",e.A="a",e.IFRAME="iframe",e.FRAME="frame",e.OTHER="other"}(r||(r={}));var a,o=Object.freeze({__proto__:null,get AssetType(){return s},get RequestType(){return n},get PerformanceEntryInitiatorType(){return r},get PerformanceEntryType(){return t.PerformanceEntryType}});function c(e,t){return new Promise((s=>setTimeout((()=>s(t)),e)))}function d(e){const t=e&&e.serverTiming,s=t&&t.find((({name:e})=>"RequestID"===e));return s&&s.description||""}async function l(e,{timeout:t=50,attempts:s=10}={}){let n=!1;for(;!n&&s>0;)n=e(),await c(t),s-=1;return n}async function h(){const e=await navigator.permissions.query({name:"notifications"});return"denied"===Notification.permission&&"prompt"===e.state}async function m(e){if(!navigator.permissions)return!1;try{return e?await async function(){return Promise.race([h(),c(100,!0)])}():await h()}catch(e){}return!1}!function(e){e.WEBDRIVER="webdriver",e.HEADLESS="headless"}(a||(a={}));const u=async({needDetectHeadless:e})=>{let t="";return await m(e)?t=a.HEADLESS:window.navigator.webdriver&&(t=a.WEBDRIVER),t},p=async()=>{if(navigator.getBattery)return navigator.getBattery().then((({level:e})=>e)).catch((()=>{}))},f=async e=>{const[t,s]=await Promise.all([u({needDetectHeadless:e.needDetectHeadless}),p()]);return{...t?{testingToolName:t}:{},screenResolutionX:window.screen.width,screenResolutionY:window.screen.height,screenPixelDensity:window.devicePixelRatio,effectiveConnectionType:window.navigator.connection?.effectiveType,referrer:window.document.referrer,deviceRam:window.navigator.deviceMemory,deviceCores:window.navigator.hardwareConcurrency,downlink:window.navigator.connection?.downlink,roundTripTime:window.navigator.connection?.rtt,isPwa:window.navigator.standalone||window.matchMedia("(display-mode: standalone)").matches,deviceBattery:s,fps:e.fps}},E={html_head_start:"htmlHeadStart",link_preloaded:"linkPreloaded",meta_loaded:"metaLoaded",link_preconnected:"linkPreconnected",fonts_loaded:"fontsLoaded",css_parsed:"cssParsed",head_html_parsed:"headHtmlParsed",body_html_parsed:"bodyHtmlParsed",HYDRATION_TIME:"appInitEnd"},g=()=>{const e={htmlHeadStart:0,linkPreloaded:0,metaLoaded:0,linkPreconnected:0,fontsLoaded:0,cssParsed:0,headHtmlParsed:0,bodyHtmlParsed:0,appInitEnd:0};for(const[t,s]of Object.entries(E)){const n=performance.getEntriesByName(t)[0];n&&(e[s]=n.startTime)}return e},v=()=>{const e=[];return Object.keys(E).forEach((t=>{const s=performance.getEntriesByName(t)[0];s&&e.push({name:t,time:s.startTime})})),e},T=()=>{return(e=t.PerformanceEntryType.NAVIGATION,performance.getEntriesByType(e))[0]||{};var e},w=(e,t)=>e.map((e=>({networkTiming:t.find((t=>t.name===e))||{name:e}}))),y=(e,t,s)=>e.map((e=>{const{startupTime:n,stallCount:i,stallDuration:r,viewTime:a,manifestUrls:o,videoUrls:c}=e;return{requestId:s,startupTime:n,stallCount:i,stallDuration:r,viewTime:a,manifestTiming:w(o||[],t.localFetchEntriesStore),files:w(c,t.localFetchEntriesStore)}}));class b{observer;entries=[];constructor(){this.observer=new PerformanceObserver((e=>{this.entries=e.getEntries(),this.observer.disconnect()})),this.observer.observe({type:"element",buffered:!0})}async collectData(){if(!document||!document.querySelectorAll("[elementtiming]").length)return[];if(await l((()=>this.entries.length>0)),!this.entries.length)return[];const e=[],t=new Set;let s=0;for(;e.length<=5&&s<this.entries.length;){const n=this.entries[s],i=n.identifier;t.has(i)||(t.add(i),e.push(n)),s++}return e.map((e=>{const t=e.identifier.replace("lcp_eltiming_",""),s=performance.getEntriesByName("lcp_script_"+t)[0];return{name:t,loadTime:e.loadTime,renderTime:e.renderTime,scriptTiming:s&&s.startTime,networkTiming:performance.getEntriesByName(e.url)[0]}}))}}const A=["adsense","google_ad"],I=()=>A[Math.floor(Math.random()*A.length)];let _=!1;const C=1,L=2,k=3,P=4;let O=0,S=0,N=0,R=0,F=0,D=0;function M(){!async function(){try{if(!navigator.permissions)return void(O=P);if("undefined"==typeof Notification)return void(O=P);const e=await new Promise((e=>{navigator.permissions.query({name:"notifications"}).then((t=>{const s=t.state;e("denied"===Notification.permission&&("prompt"===s||"granted"===s))}))}));O=e?L:C}catch(e){throw O=k,e}}(),(async()=>{const e=document.createElement("div");e.id=`${I()}`,e.className=`${I()}`,e.style.height="1px",e.style.width="1px",document.body.appendChild(e),_=await l((()=>e&&0===e.offsetHeight||0===e.offsetWidth||0===e.clientHeight||0===e.clientWidth||"hidden"===e.style.display||"none"===e.style.visibility||0===parseFloat(e.style.opacity)),{timeout:100,attempts:20}),document.body.removeChild(e)})(),window.addEventListener("scroll",(()=>{S++}),!0),window.addEventListener("mousemove",(()=>{N++}),!0),window.addEventListener("touchmove",(()=>{R++}),!0),window.addEventListener("keydown",(()=>{F++}),!0),window.addEventListener("click",(()=>{D++}),!0)}const B=(e,t,s,n,i)=>{let r={};if(e){const t=e.querySelectorAll("img");for(let e of t){const t=e.getAttribute("src"),s=i.find((e=>e.name===t));s&&s.responseEnd>r.mediaLoadMaxTime&&(r.mediaLoadMaxTime=s.responseEnd,r.mediaLoadMaxUrl=t)}}return{widgetName:t,widgetRenderTime:s,isFirstMount:n.isFirstMount,isComposerAsyncWidget:n.isAsyncWidget,...r}},H=e=>{const s=performance.getEntriesByType(t.PerformanceEntryType.MARK),n={};return s.forEach((t=>{const{name:s,startTime:i,detail:r}=t;if(!r||!r.widgetRenderEnd)return;const a=document.querySelector(`[data-mark=${s}]`),o=e.localFetchEntriesStore;if(!a||a.dataset.widget){const e=((e,t,s,n,i)=>{const r=i.find((e=>e.name.includes(t)));let a={};return r&&(a.requestId=d(r),a.networkTiming=r),{...a,...B(e,t,s,n,i)}})(a,s,i,r,o);e&&(n[s]=e)}else{const e=a.closest("[data-widget]");if(!e)return;const t=e.dataset.widget||"";n[t]||(n[t]={widgetName:t}),n[t].nestedWidgets||(n[t].nestedWidgets=[]);const c=B(a,s,i,r,o);n[t].nestedWidgets.push(c)}})),Object.values(n).slice(0,30)};class q{config;vitalsObserver;fpsCounter;constructor(e,t,s){this.config=e,this.vitalsObserver=t,this.fpsCounter=s}async createCommonBlocks(e){return{browser:await f({fps:e,needDetectHeadless:this.config.needDetectHeadless})}}async createHtmlEvent(e={}){const{tabClosing:t}=e,{htmlRequestId:s,htmlRequestIdTimestamp:n,trackPerformanceMarks:i}=this.config,r=i&&!t;let a;a=t?this.vitalsObserver.flushWebVitals(t):await this.vitalsObserver.waitWebVitals();let o={},c={};if(i&&(o={performanceMarks:g()}),r){const e=new b;c={elements:await e.collectData()}}this.fpsCounter.stop();const d=this.fpsCounter.getResult();return{...await this.createCommonBlocks(d.avg),htmlEvent:{requestId:s,requestIdTimestamp:n,navigationTiming:T(),webVitals:a,...o,...c}}}async createAssetsEvent(e,t){const{htmlRequestId:s,htmlRequestIdTimestamp:n}=this.config;return{...await this.createCommonBlocks(),htmlEvent:{requestId:s,requestIdTimestamp:n,assets:{[t]:e.map((e=>({networkTiming:e})))}}}}async createPaginationEvent(e){return{...await this.createCommonBlocks(),paginationEvents:e}}async createStatEvent(){const{htmlRequestId:e,htmlRequestIdTimestamp:t}=this.config;return{...await this.createCommonBlocks(),statEvent:{requestId:e,requestIdTimestamp:t,blocker:_,permissions:O,nativeOnly:!navigator.webdriver,history:window.history.length,scroll:S,move:N,touch:R,click:D,key:F,duration:performance.now()}}}async createAsyncActionEvent(e){const{htmlRequestId:t,htmlRequestIdTimestamp:s}=this.config;return{...await this.createCommonBlocks(),asyncActionEvent:{requestId:t,requestIdTimestamp:s,actions:e.map((e=>({requestId:d(e),networkTiming:e})))}}}async createVideoEvent(e,t){return{...await this.createCommonBlocks(),videoEvents:y(e,t,this.config.htmlRequestId)}}async createAsyncWidgetsEvent(e){const t=H(e);return t.length?{...await this.createCommonBlocks(),asyncWidgetsEvent:{requestId:this.config.htmlRequestId,widgets:t}}:null}}var V;!function(e){e.START="start",e.END="end"}(V||(V={}));class G{heldEntries=[];sentEntries=[];capacity=20;constructor(e){this.capacity=void 0!==e.capacity?e.capacity:20}addHeldEntries(e,t=V.END){t===V.START?this.heldEntries.unshift(...e):this.heldEntries.push(...e)}addSentEntries(e){this.sentEntries.push(...e)}deleteHeldEntry(e){return"object"==typeof this.heldEntries[e]&&(this.heldEntries.splice(e,1),!0)}clearHeldEntries(){this.heldEntries=[]}clearSentEntries(){this.sentEntries=[]}isFull(){return this.heldEntries.length>=this.capacity}}const U=(e,t=!1)=>{const s=()=>{"hidden"===document.visibilityState&&(e(),t&&window.removeEventListener("visibilitychange",s))};window.addEventListener("visibilitychange",s),window.addEventListener("beforeunload",(()=>e()))},x={pageCloseEnabled:!0,capacity:20,sendTimeout:3e4,sendMethod:()=>Promise.resolve(!1)};class z{config;store;scheduledSendTimer;isOnUnload=!1;constructor(e){this.add=this.add.bind(this),this.config={...x,...e},this.store=new G({capacity:this.config.capacity}),this.scheduledSendTimer=((e,t)=>{let s;const n={start(){n.cancel(),s=window.setTimeout(e,t)},cancel(){window.clearTimeout(s),s=void 0}};return n})((()=>this.send()),this.config.sendTimeout),setTimeout((()=>{U(this.flush.bind(this),!0)}))}add(e,{forceSend:t=!1}={}){if(this.isOnUnload)return this.scheduledSendTimer.cancel(),void this.store.addHeldEntries([e]);this.store.addHeldEntries([e]),this.store.isFull()||t?this.flush():this.scheduledSendTimer.start()}flush(){this.scheduledSendTimer.cancel(),this.send()}async send(){const e=this.store.heldEntries.slice();e.length&&(this.config.sendMethod(e),this.store.clearHeldEntries(),this.store.addSentEntries(e))}}class W{observer;entriesBuffer;entryList=[];resourceObserver;config;constructor(e,t,s){this.resourceObserver=t,this.config=s,this.entriesBuffer=new z({sendTimeout:5e3,sendMethod:e}),this.observer=new PerformanceObserver(this.collectMarks),document.addEventListener("pagehide",this.stopCollectMarks)}collectMarks=e=>{const t=e.getEntries();this.entryList=this.entryList.concat(t),t.filter((e=>"paginationEnd"===e.name)).forEach((e=>{const t=this.createPaginationEvent(e);t&&this.entriesBuffer.add(t)}))};createPaginationEvent(e){const t=e.detail?.queryUrl||"";if(t){const s=this.entryList.filter((e=>"paginationStart"===e.name)).find((e=>e.detail?.queryUrl===t));if(s?.startTime)return this.createPaginationEntry(t,s,e)}}createPaginationEntry(e,t,s){const n=this.resourceObserver.localFetchEntriesStore.find((t=>t.name.includes(e))),i=t.startTime,r=s.startTime-i,a=s.detail.loaderVisibleTime,o=a?a.end-a.start:void 0,c=t.detail,l=c.paginationIndex||c.index||-1;if(n)return{pageRequestId:this.config.htmlRequestId,requestId:d(n),layoutContainer:c.layoutContainer||"",stateId:c.stateId||"",index:l,totalTime:r,networkTiming:n,loaderVisibleTime:o}}startCollectMarks(){this.observer.observe({type:"mark",buffered:!0})}stopCollectMarks=()=>{this.observer.disconnect()}}const Y=new class{_firstHiddenTime=-1;get firstHiddenTime(){return this._firstHiddenTime}constructor(){if(this._firstHiddenTime=this.initHiddenTime(),this._firstHiddenTime>0){const e=t=>{"hidden"===document.visibilityState&&(this._firstHiddenTime=t.timeStamp,window.removeEventListener("visibilitychange",e,!0))};window.addEventListener("visibilitychange",e,!0)}}initHiddenTime(){let e=1/0;return"hidden"!==document.visibilityState||document.prerendering||(e=0),e}};var j;!function(e){e[e.UNSPECIFIED=0]="UNSPECIFIED",e[e.EMPTY_ENTRY_LIST=1]="EMPTY_ENTRY_LIST",e[e.PAGE_OPENED_IN_BACKGROUND=2]="PAGE_OPENED_IN_BACKGROUND",e[e.PAGE_MOVED_TO_BACKGROUND=3]="PAGE_MOVED_TO_BACKGROUND",e[e.LCP_IS_GREATER_THAN_NAV_TOTAL_TIME=4]="LCP_IS_GREATER_THAN_NAV_TOTAL_TIME",e[e.LCP_ENTRY_TIME_PROPS_MISSING=5]="LCP_ENTRY_TIME_PROPS_MISSING",e[e.TAB_CLOSING=6]="TAB_CLOSING",e[e.SEND_FULL_DATA_AFTER_BEFORE_UNLOAD=7]="SEND_FULL_DATA_AFTER_BEFORE_UNLOAD"}(j||(j={}));const K=e=>e.renderTime||e.loadTime,$=e=>{if(!e)return[];const t=[];let s=e;for(;s.parentNode&&"BODY"!==s.nodeName;){const e=s.getAttribute("data-widget");e&&t.push(e),s=s.parentNode}return t},X=()=>T().loadEventEnd;class J{config={prerendering:!1,trackLcpAspects:!1};LCP={entries:[]};CLS={entries:[]};FID={entries:[]};LT={entries:[]};clsObserver;lcpObserver;fidObserver;ltObserver;lcpAspects=void 0;lastLcpEntry=void 0;zeroLcpReason=j.UNSPECIFIED;constructor(e){this.config=e,this.lcpObserver=new PerformanceObserver((e=>{this.collectEntries(e,"LCP")})),this.clsObserver=new PerformanceObserver((e=>{this.collectEntries(e,"CLS")})),this.fidObserver=new PerformanceObserver((e=>{this.collectEntries(e,"FID")})),this.ltObserver=new PerformanceObserver((e=>{this.collectEntries(e,"LT")})),this.lcpObserver.observe({type:t.PerformanceEntryType.LCP,buffered:!0}),this.clsObserver.observe({type:t.PerformanceEntryType.CLS,buffered:!0}),this.fidObserver.observe({type:t.PerformanceEntryType.FID,buffered:!0}),this.ltObserver.observe({type:t.PerformanceEntryType.LONGTASK,buffered:!0})}stopCollecting(){this.lcpObserver.disconnect(),this.clsObserver.disconnect(),this.fidObserver.disconnect(),this.ltObserver.disconnect()}collectEntries(e,t){const s=e.getEntries();for(const e of s)this[t].entries.push(e)}calculateLCP(){if(this.zeroLcpReason=j.UNSPECIFIED,0===Y.firstHiddenTime)return this.zeroLcpReason=j.PAGE_OPENED_IN_BACKGROUND,0;let e=this.LCP.entries;0===e.length&&(this.zeroLcpReason=j.EMPTY_ENTRY_LIST),e=e.filter((e=>e.startTime<Y.firstHiddenTime)),0===e.length&&Y.firstHiddenTime!==1/0&&(this.zeroLcpReason=j.PAGE_MOVED_TO_BACKGROUND);const t=X();if(!this.config.prerendering){const s=e.filter((e=>K(e)<=t+1e3));this.zeroLcpReason===j.UNSPECIFIED&&0===s.length&&(this.zeroLcpReason=j.LCP_IS_GREATER_THAN_NAV_TOTAL_TIME)}this.lastLcpEntry=e[e.length-1];let s=this.lastLcpEntry?K(this.lastLcpEntry):0;return this.zeroLcpReason===j.UNSPECIFIED&&null==s&&(this.zeroLcpReason=j.LCP_ENTRY_TIME_PROPS_MISSING),s}async waitForLCP(){return await l((()=>this.LCP.entries.length>0),{timeout:50,attempts:20,label:"LCP"})}async startCalculateLcpAspects(){const e=this.lastLcpEntry?.element,t=e?.localName||"",s=e?.currentSrc||"",n=Math.round(window.scrollY);if(this.lcpAspects={loadTime:this.lastLcpEntry?.loadTime||0,renderTime:this.lastLcpEntry?.renderTime||0,widgets:e?$(e):[],size:this.lastLcpEntry?.size||0,tag:t,url:s,scrollPosition:n,zeroValueReason:this.zeroLcpReason,zeroValueReasonExperiment:this.zeroLcpReason},s){await l((()=>performance.getEntriesByName(s).length>0),{label:"lcpAspects"});const t=performance.getEntriesByName(s)[0];this.lcpAspects.networkTiming=t,this.lcpAspects.widgets=e?$(e):[]}}calculateCLS(){const e=X();return this.CLS.entries.reduce(((t,s)=>s.startTime<=e&&!s.hadRecentInput?t+s.value:t),0)}calculateFID(){const e=this.FID.entries[0];return e?e.processingStart-e.startTime:0}calculateLT(){return this.LT.entries.length}async waitWebVitals(){return this.calculateLCP(),this.lastLcpEntry&&!this.config.prerendering||(await this.waitForLCP(),this.calculateLCP()),this.stopCollecting(),await this.startCalculateLcpAspects(),this.flushWebVitals()}flushWebVitals(e=!1){const t={cls:this.calculateCLS(),lcp:this.calculateLCP(),fid:this.calculateFID(),lt:this.calculateLT()};if(this.config.trackLcpAspects){this.lcpAspects||this.startCalculateLcpAspects();const s=[j.PAGE_OPENED_IN_BACKGROUND,j.PAGE_MOVED_TO_BACKGROUND];e&&this.lcpAspects&&!s.includes(this.lcpAspects.zeroValueReason)&&(this.lcpAspects.zeroValueReasonExperiment=j.TAB_CLOSING),t.lcpAspects=this.lcpAspects}return t}}const Q={[s.IMAGES]:{createCondition:e=>!!e.trackImages,collectCondition:function(e){const t=e.initiatorType===r.IMG,s=e.initiatorType===r.CSS&&/.(jpe?g|png|webp)/i.test(e.name);return t||s}},[s.SCRIPTS]:{createCondition:e=>!!e.trackAssets,collectCondition:function(e){return/\.js$/.test(e.name)}},[s.CSS]:{createCondition:e=>!!e.trackAssets,collectCondition:function(e){return/\.css$/.test(e.name)}},[s.FONTS]:{createCondition:e=>!!e.trackAssets,collectCondition:function(e){return/\.woff2?$/.test(e.name)}},[s.JSON]:{createCondition:e=>!!e.trackAssets,collectCondition:function(e){return/\.json$/.test(e.name)}},[n.ASYNC_ACTION]:{createCondition:e=>!!e.trackAsyncActions,collectCondition:function(e){return/\/composer-api.bx\/_action/.test(e.name)}}};class Z{observer;bufferMap={};localFetchEntriesStore=[];config;constructor(e){this.config=e,Object.keys(Q).forEach((t=>{Q[t].createCondition(e)&&(this.bufferMap[t]=new z({sendMethod:s=>e.sendCallback(s,t)}))})),this.observer=new PerformanceObserver(this.collectEntries),document.addEventListener("pagehide",this.stopCollectEntries)}collectEntries=e=>{e.getEntries().forEach((e=>{if(e.initiatorType!==r.FETCH&&e.initiatorType!==r.VIDEO||this.localFetchEntriesStore.push(e),!(e.decodedBodySize<=0)&&(this.config.trackAssets||this.config.trackImages||this.config.trackAsyncActions)){const t=Object.keys(this.bufferMap);for(let s=0;s<t.length;s++){const n=t[s],i=this.bufferMap[n];if(Q[n].collectCondition(e)&&i){i.add(e);break}}}}))};startCollectEntries(){this.observer.observe({type:"resource",buffered:!0})}stopCollectEntries=()=>{this.observer.disconnect()}}class ee{startTime=0;lastFrameTime=0;totalFrames=0;lastFrameFps=0;minFps=Number.MAX_SAFE_INTEGER;maxFps=0;continue=!0;reset(){this.continue=!0;const e=performance.now();this.startTime=e,this.lastFrameTime=e,this.totalFrames=0,this.lastFrameFps=0,this.minFps=Number.MAX_SAFE_INTEGER,this.maxFps=0}start(){this.reset();const e=()=>{this.totalFrames++;const t=performance.now(),s=t-this.lastFrameTime;this.lastFrameFps=1e3/s,this.minFps=Math.min(this.minFps,this.lastFrameFps),this.maxFps=Math.max(this.maxFps,this.lastFrameFps),this.lastFrameTime=t,this.continue&&window.requestAnimationFrame(e)};window.requestAnimationFrame(e)}stop(){this.continue=!1}get avgFps(){return 1e3*this.totalFrames/(this.lastFrameTime-this.startTime)}getResult(){return{last:this.lastFrameFps,min:this.minFps,max:this.maxFps,avg:this.avgFps}}}t.PerformanceTracker=class{config;builder;paginationObserver;resourceObserver;vitalsObserver;fpsCounter;wasSent=!1;constructor(e){this.config=e,this.vitalsObserver=new J({trackLcpAspects:e.trackLcpAspects,prerendering:document.prerendering}),this.fpsCounter=new ee,this.fpsCounter.start(),this.builder=new q(this.config,this.vitalsObserver,this.fpsCounter);const t=this.sendPagination.bind(this),s=this.sendBufferedEvent.bind(this);this.resourceObserver=new Z({trackImages:e.trackImages,trackAssets:e.trackAssets,trackAsyncActions:e.trackAsyncActions,sendCallback:s}),this.resourceObserver.startCollectEntries(),e.trackPagination&&(this.paginationObserver=new W(t,this.resourceObserver,e),this.paginationObserver.startCollectMarks()),e.needDetectHeadless&&setTimeout((()=>{M(),U(this.sendStat.bind(this))}),0)}async onLoad(){const e=await this.builder.createHtmlEvent();if(this.wasSent){const t=e.htmlEvent.webVitals.lcpAspects;t&&(t.zeroValueReasonExperiment=j.SEND_FULL_DATA_AFTER_BEFORE_UNLOAD)}return this.send(e)}async onBeforeUnload(){const e=await this.builder.createHtmlEvent({tabClosing:!0}),t=this.send(e);return t&&(this.wasSent=!0),t}async sendBufferedEvent(e,t){if(t===n.ASYNC_ACTION){const t=await this.builder.createAsyncActionEvent(e);return this.send(t)}const s=await this.builder.createAssetsEvent(e,t);return this.send(s)}async sendPagination(e){const t=await this.builder.createPaginationEvent(e);return this.send(t)}async sendVideoMetrics(e){const t=await this.builder.createVideoEvent(e,this.resourceObserver);return this.send(t)}async sendStat(){const e=await this.builder.createStatEvent();return this.send(e)}async sendAsyncWidgets(){const e=await this.builder.createAsyncWidgetsEvent(this.resourceObserver);e&&this.send(e)}send(e){const t=JSON.stringify(e);return navigator.sendBeacon(this.config.endpoint,t)}getDataForDevTools(){const e=T();return{navigationTiming:e,navigationTimingExt:{ttfb:e.responseStart-e.domainLookupStart,ttlb:e.responseEnd-e.domainLookupStart},webVitals:this.vitalsObserver.flushWebVitals(),performanceMarks:v()}}},t.Types=o,t.extractRequestId=d,t.getBrowserData=f,t.getNavigationTimings=T,t.sleep=c,t.waitFor=l,t.whenActivated=function(e){document.prerendering?window.addEventListener("prerenderingchange",(()=>{e(!0)}),!0):e(!1)}}(e={exports:{}},e.exports),e.exports);(t=s)&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")&&t.default,s.PerformanceEntryType;var n=s.PerformanceTracker;s.Types;var i=s.extractRequestId;s.getBrowserData;var r=s.getNavigationTimings;s.sleep,s.waitFor;var a=s.whenActivated;const o=()=>{const e=r();return i(e)};class c{tracker;constructor(){this.trackVideoMetrics=this.trackVideoMetrics.bind(this);const{requestId:e,requestIdTimestamp:t,endpoint:s,trackImages:i,trackAssets:r,detectHeadless:c,pageViewId:d,trackLcpAspects:l,trackPerformanceMarks:h,trackPagination:m,trackAsyncActions:u}=(()=>{const e=window.__cpmInit__;return{trackImages:e.trackImages,trackAssets:e.trackAssets,detectHeadless:e.detectHeadless,trackLcpAspects:e.trackLcpAspects,trackPerformanceMarks:e.trackPerformanceMarks,trackPagination:!0,trackAsyncActions:e.trackAsyncActions,requestId:o(),requestIdTimestamp:e.requestIdTimestamp,endpoint:`${e.basePath}/perf-metrics-collector/v4/rum/bx/web`,pageViewId:window.$tracker?.pageViewId}})();this.tracker=new n({endpoint:s,htmlRequestId:e,htmlRequestIdTimestamp:t,trackImages:i,trackAssets:r,needDetectHeadless:c,pageViewId:d,trackLcpAspects:l||h,trackPerformanceMarks:h,trackPagination:m,trackAsyncActions:u}),a((()=>{const e=()=>{this.tracker.onBeforeUnload()},t=async()=>{await this.tracker.onLoad()&&window.removeEventListener("beforeunload",e)};window.addEventListener("beforeunload",e),window.addEventListener("beforeunload",(()=>{this.tracker.sendAsyncWidgets()})),"complete"===document.readyState?setTimeout(t,0):window.addEventListener("load",(()=>setTimeout(t,0)))}))}trackVideoMetrics(e){e&&e.length&&this.tracker&&this.tracker.sendVideoMetrics(e)}getDataForDevTools(){return this.tracker.getDataForDevTools()}}if(window.PerformanceObserver)try{window.$perfTracker=new c}catch{}}();
